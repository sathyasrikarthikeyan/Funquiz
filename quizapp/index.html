<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fun Quiz App for Kids</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap"
    rel="stylesheet"
  />
   <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Comic Neue', cursive, sans-serif;
    }

    .bounce-hover:hover {
      animation: bounce 0.6s;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .fade-slide-in {
      animation: fadeSlideIn 0.7s ease-out forwards;
      opacity: 0;
      transform: translateY(20px);
    }

    @keyframes fadeSlideIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .confetti-piece {
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: var(--confetti-color);
      opacity: 0.9;
      animation: confetti-fall 1.5s linear forwards;
      border-radius: 2px;
    }

    @keyframes confetti-fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(300px) rotate(360deg); opacity: 0; }
    }
  </style>

</head>
<body class="w-[70%] max-w-4xl mx-auto bg-yellow-200 rounded-xl shadow-lg p-8 fade-slide-in">

  <div id="app" class="flex-grow flex flex-col max-w-4xl mx-auto p-4 sm:p-6 md:p-8">

    <!-- Header -->
    <header class="flex justify-between items-center mb-6">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-yellow-700 select-none">
        Funquiz 
      </h1>
      <button
        id="btnMyProfile"
        class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-2 px-4 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300"
        aria-label="Open My Profile"
      >
        <i class="fas fa-user-circle mr-2"></i>My Profile
      </button>
    </header>

    <!-- Main Content Area -->
    <main id="mainContent" class="flex-grow relative">
      <!-- Content injected by JS -->
    </main>

  </div>

  <!-- Audio for correct/wrong answer -->
  <audio id="audioCorrect" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
  <audio id="audioWrong" src="https://actions.google.com/sounds/v1/cartoon/boing.ogg" preload="auto"></audio>

  <script>
    (() => {
      // Data for categories
      const categories = [
        { id: 'birds', name: 'Birds üê¶', color: 'bg-blue-400', hoverColor: 'hover:bg-blue-500' },
        { id: 'animals', name: 'Animals üêò', color: 'bg-green-400', hoverColor: 'hover:bg-green-500' },
        { id: 'sports', name: 'Sports üèÄ', color: 'bg-red-400', hoverColor: 'hover:bg-red-500' },
        { id: 'science', name: 'Science üß™', color: 'bg-purple-400', hoverColor: 'hover:bg-purple-500' },
        { id: 'history', name: 'History üìú', color: 'bg-yellow-400', hoverColor: 'hover:bg-yellow-500' },
        { id: 'geography', name: 'Geography üåç', color: 'bg-indigo-400', hoverColor: 'hover:bg-indigo-500' },
        { id: 'movies', name: 'Movies üé¨', color: 'bg-pink-400', hoverColor: 'hover:bg-pink-500' },
        { id: 'technology', name: 'Technology üíª', color: 'bg-teal-400', hoverColor: 'hover:bg-teal-500' },
        { id: 'literature', name: 'Literature üìö', color: 'bg-orange-400', hoverColor: 'hover:bg-orange-500' },
        { id: 'music', name: 'Music üéµ', color: 'bg-cyan-400', hoverColor: 'hover:bg-cyan-500' },
      ];

      // Questions per category (10 each)
      // For brevity, questions are simple and short, but enough to fulfill requirements
      // Each question: { question, options: [A,B,C,D], answer: index (0-3) }
      const questionsData = {
        birds: [
          {
            question: "Which bird is known for its colorful feathers and fan-shaped tail?",
            options: ["Peacock", "Eagle", "Penguin", "Owl"],
            answer: 0,
          },
          {
            question: "What bird is famous for mimicking human speech?",
            options: ["Parrot", "Sparrow", "Crow", "Seagull"],
            answer: 0,
          },
          {
            question: "Which bird cannot fly but is a great swimmer?",
            options: ["Penguin", "Flamingo", "Hummingbird", "Robin"],
            answer: 0,
          },
          {
            question: "What bird is a symbol of peace?",
            options: ["Dove", "Hawk", "Vulture", "Falcon"],
            answer: 0,
          },
          {
            question: "Which bird is the fastest in flight?",
            options: ["Peregrine Falcon", "Albatross", "Eagle", "Swallow"],
            answer: 0,
          },
          {
            question: "Which bird builds nests out of mud?",
            options: ["Swallow", "Woodpecker", "Crow", "Ostrich"],
            answer: 0,
          },
          {
            question: "What bird is known for its loud, distinctive laugh-like call?",
            options: ["Kookaburra", "Robin", "Canary", "Pelican"],
            answer: 0,
          },
          {
            question: "Which bird migrates thousands of miles every year?",
            options: ["Arctic Tern", "Pigeon", "Turkey", "Swan"],
            answer: 0,
          },
          {
            question: "What bird is famous for its ability to hover in place?",
            options: ["Hummingbird", "Crow", "Eagle", "Owl"],
            answer: 0,
          },
          {
            question: "Which bird is the largest flying bird?",
            options: ["Albatross", "Condor", "Swan", "Pelican"],
            answer: 1,
          },
        ],
        animals: [
          {
            question: "Which animal is known as the King of the Jungle?",
            options: ["Lion", "Tiger", "Elephant", "Giraffe"],
            answer: 0,
          },
          {
            question: "What is the largest land animal?",
            options: ["Elephant", "Rhino", "Hippo", "Giraffe"],
            answer: 0,
          },
          {
            question: "Which animal is famous for its black and white stripes?",
            options: ["Zebra", "Tiger", "Panda", "Skunk"],
            answer: 0,
          },
          {
            question: "What animal is known for changing its color to blend in?",
            options: ["Chameleon", "Frog", "Snake", "Lizard"],
            answer: 0,
          },
          {
            question: "Which animal is the fastest land animal?",
            options: ["Cheetah", "Lion", "Horse", "Gazelle"],
            answer: 0,
          },
          {
            question: "What animal has a long trunk?",
            options: ["Elephant", "Rhino", "Hippo", "Camel"],
            answer: 0,
          },
          {
            question: "Which animal is known for building dams?",
            options: ["Beaver", "Otter", "Muskrat", "Mole"],
            answer: 0,
          },
          {
            question: "What animal is famous for its pouch to carry babies?",
            options: ["Kangaroo", "Koala", "Opossum", "Wallaby"],
            answer: 0,
          },
          {
            question: "Which animal is the tallest in the world?",
            options: ["Giraffe", "Elephant", "Camel", "Ostrich"],
            answer: 0,
          },
          {
            question: "What animal is known for its slow movement and shell?",
            options: ["Turtle", "Snail", "Slug", "Crab"],
            answer: 0,
          },
        ],
        sports: [
          {
            question: "How many players are on a basketball team on the court?",
            options: ["5", "6", "7", "4"],
            answer: 0,
          },
          {
            question: "Which sport uses a shuttlecock?",
            options: ["Badminton", "Tennis", "Squash", "Volleyball"],
            answer: 0,
          },
          {
            question: "In soccer, what is the main objective?",
            options: ["Score goals", "Catch the ball", "Run fastest", "Hit the ball"],
            answer: 0,
          },
          {
            question: "Which sport is played on ice with sticks and a puck?",
            options: ["Ice Hockey", "Curling", "Figure Skating", "Skiing"],
            answer: 0,
          },
          {
            question: "What sport uses a bat and a ball and has bases?",
            options: ["Baseball", "Cricket", "Golf", "Tennis"],
            answer: 0,
          },
          {
            question: "Which sport is known as the 'king of sports' worldwide?",
            options: ["Soccer", "Basketball", "Tennis", "Baseball"],
            answer: 0,
          },
          {
            question: "In which sport do players wear helmets and shoulder pads?",
            options: ["American Football", "Rugby", "Hockey", "Lacrosse"],
            answer: 0,
          },
          {
            question: "Which sport involves riding waves on a board?",
            options: ["Surfing", "Sailing", "Swimming", "Water Polo"],
            answer: 0,
          },
          {
            question: "What sport uses a net and a ball and is played on a court?",
            options: ["Volleyball", "Basketball", "Tennis", "Badminton"],
            answer: 0,
          },
          {
            question: "Which sport is played in a pool with a ball and goals?",
            options: ["Water Polo", "Swimming", "Diving", "Synchronized Swimming"],
            answer: 0,
          },
        ],
        science: [
          {
            question: "What planet is known as the Red Planet?",
            options: ["Mars", "Venus", "Jupiter", "Saturn"],
            answer: 0,
          },
          {
            question: "What gas do plants breathe in to make food?",
            options: ["Carbon Dioxide", "Oxygen", "Nitrogen", "Hydrogen"],
            answer: 0,
          },
          {
            question: "What is the center of an atom called?",
            options: ["Nucleus", "Electron", "Proton", "Neutron"],
            answer: 0,
          },
          {
            question: "What force pulls objects toward Earth?",
            options: ["Gravity", "Magnetism", "Friction", "Electricity"],
            answer: 0,
          },
          {
            question: "What do bees collect from flowers?",
            options: ["Nectar", "Pollen", "Water", "Leaves"],
            answer: 0,
          },
          {
            question: "What is H2O commonly known as?",
            options: ["Water", "Oxygen", "Hydrogen", "Salt"],
            answer: 0,
          },
          {
            question: "Which organ pumps blood in the human body?",
            options: ["Heart", "Lungs", "Brain", "Kidneys"],
            answer: 0,
          },
          {
            question: "What do you call animals that eat only plants?",
            options: ["Herbivores", "Carnivores", "Omnivores", "Insectivores"],
            answer: 0,
          },
          {
            question: "What is the boiling point of water in Celsius?",
            options: ["100¬∞C", "0¬∞C", "50¬∞C", "212¬∞C"],
            answer: 0,
          },
          {
            question: "What gas do humans breathe out?",
            options: ["Carbon Dioxide", "Oxygen", "Nitrogen", "Helium"],
            answer: 0,
          },
        ],
        history: [
          {
            question: "Who was the first President of the United States?",
            options: ["George Washington", "Abraham Lincoln", "Thomas Jefferson", "John Adams"],
            answer: 0,
          },
          {
            question: "What ancient civilization built the pyramids?",
            options: ["Egyptians", "Romans", "Greeks", "Mayans"],
            answer: 0,
          },
          {
            question: "Which war was fought between the North and South in the USA?",
            options: ["Civil War", "World War I", "Revolutionary War", "World War II"],
            answer: 0,
          },
          {
            question: "Who discovered America in 1492?",
            options: ["Christopher Columbus", "Marco Polo", "Vasco da Gama", "Ferdinand Magellan"],
            answer: 0,
          },
          {
            question: "What wall divided East and West Berlin?",
            options: ["Berlin Wall", "Great Wall", "Hadrian's Wall", "Wall of China"],
            answer: 0,
          },
          {
            question: "Who was famous for the theory of relativity?",
            options: ["Albert Einstein", "Isaac Newton", "Galileo Galilei", "Nikola Tesla"],
            answer: 0,
          },
          {
            question: "What was the name of the ship that carried Pilgrims to America?",
            options: ["Mayflower", "Santa Maria", "Endeavour", "Beagle"],
            answer: 0,
          },
          {
            question: "Who was the queen of England during the Spanish Armada?",
            options: ["Queen Elizabeth I", "Queen Victoria", "Queen Mary", "Queen Anne"],
            answer: 0,
          },
          {
            question: "What year did World War II end?",
            options: ["1945", "1939", "1918", "1963"],
            answer: 0,
          },
          {
            question: "Who was the famous civil rights leader who gave 'I Have a Dream' speech?",
            options: ["Martin Luther King Jr.", "Malcolm X", "Rosa Parks", "Frederick Douglass"],
            answer: 0,
          },
        ],
        geography: [
          {
            question: "What is the largest ocean on Earth?",
            options: ["Pacific Ocean", "Atlantic Ocean", "Indian Ocean", "Arctic Ocean"],
            answer: 0,
          },
          {
            question: "Which continent is the Sahara Desert located in?",
            options: ["Africa", "Asia", "Australia", "South America"],
            answer: 0,
          },
          {
            question: "What is the capital city of France?",
            options: ["Paris", "London", "Berlin", "Madrid"],
            answer: 0,
          },
          {
            question: "Mount Everest is located in which mountain range?",
            options: ["Himalayas", "Alps", "Rockies", "Andes"],
            answer: 0,
          },
          {
            question: "Which country is shaped like a boot?",
            options: ["Italy", "Spain", "Greece", "Portugal"],
            answer: 0,
          },
          {
            question: "What river runs through Egypt?",
            options: ["Nile", "Amazon", "Mississippi", "Yangtze"],
            answer: 0,
          },
          {
            question: "Which country has the most people?",
            options: ["China", "India", "USA", "Russia"],
            answer: 0,
          },
          {
            question: "What is the smallest country in the world?",
            options: ["Vatican City", "Monaco", "Nauru", "San Marino"],
            answer: 0,
          },
          {
            question: "Which continent is Australia part of?",
            options: ["Australia", "Asia", "Europe", "Africa"],
            answer: 0,
          },
          {
            question: "What is the capital of Japan?",
            options: ["Tokyo", "Kyoto", "Osaka", "Hiroshima"],
            answer: 0,
          },
        ],
        movies: [
          {
            question: "Who is the famous wizard in the Harry Potter series?",
            options: ["Harry Potter", "Ron Weasley", "Hermione Granger", "Draco Malfoy"],
            answer: 0,
          },
          {
            question: "Which movie features a talking snowman named Olaf?",
            options: ["Frozen", "Tangled", "Moana", "Brave"],
            answer: 0,
          },
          {
            question: "What kind of animal is Simba in The Lion King?",
            options: ["Lion", "Tiger", "Elephant", "Bear"],
            answer: 0,
          },
          {
            question: "In Toy Story, who is the cowboy doll?",
            options: ["Woody", "Buzz Lightyear", "Jessie", "Rex"],
            answer: 0,
          },
          {
            question: "Which movie is about a superhero who can climb walls?",
            options: ["Spider-Man", "Batman", "Superman", "Iron Man"],
            answer: 0,
          },
          {
            question: "What movie features a fish named Nemo?",
            options: ["Finding Nemo", "Shark Tale", "The Little Mermaid", "Free Willy"],
            answer: 0,
          },
          {
            question: "Which movie has a character named Elsa?",
            options: ["Frozen", "Tangled", "Cinderella", "Beauty and the Beast"],
            answer: 0,
          },
          {
            question: "What movie is about toys coming to life?",
            options: ["Toy Story", "Cars", "Monsters Inc.", "Up"],
            answer: 0,
          },
          {
            question: "Who is the main villain in 'The Incredibles'?",
            options: ["Syndrome", "Mr. Incredible", "Frozone", "Edna Mode"],
            answer: 0,
          },
          {
            question: "Which movie features a magical lamp and a genie?",
            options: ["Aladdin", "Frozen", "Moana", "Tangled"],
            answer: 0,
          },
        ],
        technology: [
          {
            question: "What does 'CPU' stand for?",
            options: ["Central Processing Unit", "Computer Personal Unit", "Central Power Unit", "Computer Processing Unit"],
            answer: 0,
          },
          {
            question: "What device do you use to click on things on a computer?",
            options: ["Mouse", "Keyboard", "Monitor", "Printer"],
            answer: 0,
          },
          {
            question: "What is the name of the main circuit board in a computer?",
            options: ["Motherboard", "Hard Drive", "RAM", "Processor"],
            answer: 0,
          },
          {
            question: "Which company makes the iPhone?",
            options: ["Apple", "Samsung", "Google", "Microsoft"],
            answer: 0,
          },
          {
            question: "What does Wi-Fi allow you to do?",
            options: ["Connect to the internet wirelessly", "Print documents", "Charge your phone", "Make calls"],
            answer: 0,
          },
          {
            question: "What is software?",
            options: ["Programs and applications", "Computer parts", "Internet connection", "Hardware"],
            answer: 0,
          },
          {
            question: "What do you call a picture on a computer screen that you click?",
            options: ["Icon", "File", "Folder", "Window"],
            answer: 0,
          },
          {
            question: "What does USB stand for?",
            options: ["Universal Serial Bus", "Universal System Board", "United Serial Bus", "Universal Software Bus"],
            answer: 0,
          },
          {
            question: "What is the name of the language computers understand?",
            options: ["Binary", "English", "JavaScript", "HTML"],
            answer: 0,
          },
          {
            question: "What device shows images and videos on a computer?",
            options: ["Monitor", "Keyboard", "Mouse", "Printer"],
            answer: 0,
          },
        ],
        literature: [
          {
            question: "Who wrote 'Romeo and Juliet'?",
            options: ["William Shakespeare", "Charles Dickens", "Mark Twain", "J.K. Rowling"],
            answer: 0,
          },
          {
            question: "What is a story called that is made up and not true?",
            options: ["Fiction", "Non-fiction", "Biography", "History"],
            answer: 0,
          },
          {
            question: "Who is the author of 'Harry Potter' series?",
            options: ["J.K. Rowling", "Roald Dahl", "Dr. Seuss", "C.S. Lewis"],
            answer: 0,
          },
          {
            question: "What do you call a poem with 14 lines?",
            options: ["Sonnet", "Haiku", "Limerick", "Epic"],
            answer: 0,
          },
          {
            question: "Who wrote 'The Cat in the Hat'?",
            options: ["Dr. Seuss", "Shel Silverstein", "Roald Dahl", "Beatrix Potter"],
            answer: 0,
          },
          {
            question: "What is the main character in a story called?",
            options: ["Protagonist", "Antagonist", "Narrator", "Hero"],
            answer: 0,
          },
          {
            question: "What is a book of maps called?",
            options: ["Atlas", "Dictionary", "Encyclopedia", "Novel"],
            answer: 0,
          },
          {
            question: "Who wrote 'Charlie and the Chocolate Factory'?",
            options: ["Roald Dahl", "J.K. Rowling", "Dr. Seuss", "Lewis Carroll"],
            answer: 0,
          },
          {
            question: "What is the name of the wizard school in Harry Potter?",
            options: ["Hogwarts", "Narnia", "Middle-earth", "Neverland"],
            answer: 0,
          },
          {
            question: "What do you call the words that rhyme at the end of lines in poetry?",
            options: ["Rhyme scheme", "Alliteration", "Metaphor", "Simile"],
            answer: 0,
          },
        ],
        music: [
          {
            question: "How many strings does a standard guitar have?",
            options: ["6", "4", "8", "12"],
            answer: 0,
          },
          {
            question: "What musical instrument has black and white keys?",
            options: ["Piano", "Guitar", "Drums", "Violin"],
            answer: 0,
          },
          {
            question: "Who is known as the King of Pop?",
            options: ["Michael Jackson", "Elvis Presley", "Prince", "Freddie Mercury"],
            answer: 0,
          },
          {
            question: "What is the name of the musical symbol that means 'loud'?",
            options: ["Forte", "Piano", "Crescendo", "Decrescendo"],
            answer: 0,
          },
          {
            question: "Which instrument is played by blowing air into it?",
            options: ["Flute", "Guitar", "Drums", "Piano"],
            answer: 0,
          },
          {
            question: "What do you call a group of singers?",
            options: ["Choir", "Band", "Orchestra", "Solo"],
            answer: 0,
          },
          {
            question: "Which instrument has six strings and is played by strumming?",
            options: ["Guitar", "Violin", "Cello", "Harp"],
            answer: 0,
          },
          {
            question: "What is the speed of music called?",
            options: ["Tempo", "Pitch", "Volume", "Tone"],
            answer: 0,
          },
          {
            question: "Who composed the 'Fifth Symphony'?",
            options: ["Beethoven", "Mozart", "Bach", "Chopin"],
            answer: 0,
          },
          {
            question: "What is the name of the musical note that lasts four beats?",
            options: ["Whole note", "Half note", "Quarter note", "Eighth note"],
            answer: 0,
          },
        ],
      };

      // App state
      let profiles = {};
      let currentProfileId = null;
      let currentCategoryId = null;
      let currentQuiz = null;
      let currentQuestionIndex = 0;
      let timerInterval = null;
      let timeLeft = 0;
      const QUESTION_TIME = 15; // seconds per question

      // DOM references
      const mainContent = document.getElementById('mainContent');
      const btnMyProfile = document.getElementById('btnMyProfile');
      const audioCorrect = document.getElementById('audioCorrect');
      const audioWrong = document.getElementById('audioWrong');

      // Utility functions
      function saveProfiles() {
        localStorage.setItem('quizAppProfiles', JSON.stringify(profiles));
      }
      function loadProfiles() {
        const data = localStorage.getItem('quizAppProfiles');
        if (data) {
          profiles = JSON.parse(data);
        }
      }
      function generateId() {
        return 'id-' + Math.random().toString(36).substr(2, 9);
      }
      function formatDateTime(date) {
        return date.toLocaleString(undefined, {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
        });
      }
      function shuffleArray(arr) {
        const array = arr.slice();
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }
      function playSound(correct) {
        if (correct) {
          audioCorrect.currentTime = 0;
          audioCorrect.play();
        } else {
          audioWrong.currentTime = 0;
          audioWrong.play();
        }
      }

      // Confetti animation
      function createConfetti() {
        const confettiColors = ['#facc15', '#f87171', '#34d399', '#60a5fa', '#a78bfa', '#fbbf24'];
        const confettiContainer = document.createElement('div');
        confettiContainer.style.position = 'fixed';
        confettiContainer.style.top = '0';
        confettiContainer.style.left = '0';
        confettiContainer.style.width = '100vw';
        confettiContainer.style.height = '100vh';
        confettiContainer.style.pointerEvents = 'none';
        confettiContainer.style.zIndex = '9999';
        document.body.appendChild(confettiContainer);

        for (let i = 0; i < 100; i++) {
          const confetti = document.createElement('div');
          confetti.classList.add('confetti-piece');
          confetti.style.setProperty('--confetti-color', confettiColors[i % confettiColors.length]);
          confetti.style.left = Math.random() * 100 + 'vw';
          confetti.style.top = '-10px';
          confetti.style.animationDelay = (Math.random() * 1.5) + 's';
          confetti.style.animationDuration = (1 + Math.random()) + 's';
          confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
          confettiContainer.appendChild(confetti);
        }

        setTimeout(() => {
          confettiContainer.remove();
        }, 2500);
      }

      // Profile management
      function renderProfilePrompt() {
        mainContent.innerHTML = `
          <section class="max-w-md mx-auto bg-yellow-200 rounded-xl p-6 shadow-lg text-yellow-900 animate-fade-slide-in">
            <h2 class="text-2xl font-bold mb-4 text-center">Welcome! What's your name?</h2>
            <form id="profileForm" class="flex flex-col space-y-4">
              <input
                type="text"
                id="profileNameInput"
                class="p-3 rounded-lg border-2 border-yellow-400 focus:outline-none focus:ring-4 focus:ring-yellow-300 text-xl font-bold placeholder-yellow-600"
                placeholder="Enter your name"
                required
                aria-label="Enter your name"
                autocomplete="off"
                maxlength="20"
              />
              <button
                type="submit"
                class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-extrabold py-3 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300"
              >
                Start
              </button>
            </form>
            <div class="mt-6 text-center">
              <h3 class="text-lg font-semibold mb-2">Or choose an existing profile:</h3>
              <div id="existingProfiles" class="flex flex-wrap justify-center gap-3"></div>
            </div>
          </section>
        `;

        const profileForm = document.getElementById('profileForm');
        const profileNameInput = document.getElementById('profileNameInput');
        const existingProfilesDiv = document.getElementById('existingProfiles');

        // Render existing profiles
        existingProfilesDiv.innerHTML = '';
        Object.entries(profiles).forEach(([id, profile]) => {
          const btn = document.createElement('button');
          btn.textContent = profile.name;
          btn.className = 'bg-yellow-300 hover:bg-yellow-400 text-yellow-900 font-bold py-2 px-4 rounded-lg shadow-md transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300';
          btn.setAttribute('aria-label', `Switch to profile ${profile.name}`);
          btn.addEventListener('click', () => {
            currentProfileId = id;
            renderCategorySelection();
          });
          existingProfilesDiv.appendChild(btn);
        });

        profileForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const name = profileNameInput.value.trim();
          if (!name) return;
          // Create new profile
          const id = generateId();
          profiles[id] = {
            id,
            name,
            quizHistory: [],
          };
          currentProfileId = id;
          saveProfiles();
          renderCategorySelection();
        });
      }

      // Category selection screen
      function renderCategorySelection() {
        currentCategoryId = null;
        currentQuiz = null;
        currentQuestionIndex = 0;
        clearInterval(timerInterval);
        mainContent.innerHTML = `
          <section aria-label="Category Selection" class="grid grid-cols-2 sm:grid-cols-3 gap-4 max-w-4xl mx-auto animate-fade-slide-in">
            ${categories
              .map(
                (cat) => `
              <button
                data-category-id="${cat.id}"
                class="flex items-center justify-center p-6 rounded-xl text-white font-extrabold text-xl sm:text-2xl text-center select-none shadow-lg transform transition duration-300 ${cat.color} ${cat.hoverColor} bounce-hover focus:outline-none focus:ring-4 focus:ring-yellow-300"
                aria-label="Select category ${cat.name}"
              >
                ${cat.name}
              </button>
            `
              )
              .join('')}
          </section>
        `;

        // Add event listeners to category buttons
        mainContent.querySelectorAll('button[data-category-id]').forEach((btn) => {
          btn.addEventListener('click', () => {
            const catId = btn.getAttribute('data-category-id');
            startQuiz(catId);
          });
        });
      }

      // Start quiz for category
      function startQuiz(categoryId) {
        currentCategoryId = categoryId;
        currentQuestionIndex = 0;
        clearInterval(timerInterval);

        // Prepare quiz questions shuffled
        const questions = questionsData[categoryId];
        if (!questions) {
          alert('No questions found for this category.');
          renderCategorySelection();
          return;
        }
        currentQuiz = shuffleArray(questions).slice(0, 10).map((q) => ({
          ...q,
          userAnswer: null,
        }));

        renderQuestion();
      }

      // Render question screen
      function renderQuestion() {
        clearInterval(timerInterval);
        timeLeft = QUESTION_TIME;

        const questionObj = currentQuiz[currentQuestionIndex];
        const totalQuestions = currentQuiz.length;

        mainContent.innerHTML = `
          <section aria-label="Quiz Question" class="max-w-3xl mx-auto bg-yellow-200 rounded-xl p-6 shadow-lg animate-fade-slide-in flex flex-col">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-2xl font-extrabold text-yellow-900 select-none">
                Question ${currentQuestionIndex + 1} of ${totalQuestions}
              </h2>
              <div aria-live="polite" aria-atomic="true" class="text-yellow-900 font-bold text-xl select-none" id="timerDisplay">
                ‚è∞ ${timeLeft}s
              </div>
            </div>
            <p class="text-xl font-semibold mb-6 text-yellow-900 select-text">${questionObj.question}</p>
            <form id="optionsForm" class="grid grid-cols-1 gap-4 mb-6">
              ${questionObj.options
                .map(
                  (opt, i) => `
                <label
                  class="flex items-center p-4 rounded-lg border-2 border-yellow-400 cursor-pointer hover:bg-yellow-300 transition transform hover:scale-105 select-none"
                  for="option${i}"
                >
                  <input
                    type="radio"
                    name="option"
                    id="option${i}"
                    value="${i}"
                    class="mr-4 accent-yellow-500"
                    ${questionObj.userAnswer === i ? 'checked' : ''}
                    aria-checked="${questionObj.userAnswer === i ? 'true' : 'false'}"
                  />
                  <span class="text-yellow-900 font-bold text-lg">${String.fromCharCode(65 + i)}. ${opt}</span>
                </label>
              `
                )
                .join('')}
            </form>
            <div class="flex justify-between">
              <button
                id="btnPrev"
                class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300 disabled:opacity-50 disabled:cursor-not-allowed"
                ${currentQuestionIndex === 0 ? 'disabled' : ''}
                aria-label="Previous question"
              >
                <i class="fas fa-arrow-left mr-2"></i>Previous
              </button>
              <button
                id="btnNext"
                class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300"
                aria-label="Next question"
              >
                Next<i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </section>
        `;

        // Timer countdown
        const timerDisplay = document.getElementById('timerDisplay');
        timerDisplay.textContent = `‚è∞ ${timeLeft}s`;
        timerInterval = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = `‚è∞ ${timeLeft}s`;
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            markUnansweredAndAdvance();
          }
        }, 1000);

        // Event listeners for options
        const optionsForm = document.getElementById('optionsForm');
        optionsForm.addEventListener('change', (e) => {
          const val = parseInt(e.target.value, 10);
          currentQuiz[currentQuestionIndex].userAnswer = val;
        });

        // Prev/Next buttons
        const btnPrev = document.getElementById('btnPrev');
        const btnNext = document.getElementById('btnNext');

        btnPrev.addEventListener('click', () => {
          saveCurrentAnswer();
          if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderQuestion();
          }
        });
        btnNext.addEventListener('click', () => {
          saveCurrentAnswer();
          if (currentQuestionIndex < currentQuiz.length - 1) {
            currentQuestionIndex++;
            renderQuestion();
          } else {
            // End quiz
            clearInterval(timerInterval);
            renderResult();
          }
        });
      }

      // Save current answer before navigation
      function saveCurrentAnswer() {
        // Already saved on change event, but just in case
        const optionsForm = document.getElementById('optionsForm');
        if (!optionsForm) return;
        const selected = optionsForm.option.value;
        if (selected !== undefined) {
          currentQuiz[currentQuestionIndex].userAnswer = parseInt(selected, 10);
        }
      }

      // Mark unanswered as incorrect and auto-advance
      function markUnansweredAndAdvance() {
        if (currentQuiz[currentQuestionIndex].userAnswer === null) {
          currentQuiz[currentQuestionIndex].userAnswer = -1; // mark as incorrect
          playSound(false);
        }
        if (currentQuestionIndex < currentQuiz.length - 1) {
          currentQuestionIndex++;
          renderQuestion();
        } else {
          renderResult();
        }
      }

      // Render result screen
      function renderResult() {
        clearInterval(timerInterval);
        // Calculate score
        let correctCount = 0;
        currentQuiz.forEach((q) => {
          if (q.userAnswer === q.answer) correctCount++;
        });
        const scorePercent = Math.round((correctCount / currentQuiz.length) * 100);

        // Save quiz result to profile history
        if (currentProfileId && profiles[currentProfileId]) {
          profiles[currentProfileId].quizHistory.push({
            categoryId: currentCategoryId,
            categoryName: categories.find((c) => c.id === currentCategoryId)?.name || '',
            score: correctCount,
            total: currentQuiz.length,
            date: new Date().toISOString(),
          });
          saveProfiles();
        }

        // Animated message and confetti if good score
        const isGreat = scorePercent >= 70;
        const messageEmoji = isGreat ? 'üéâ' : 'üí°';
        const messageText = isGreat ? 'Great Job!' : 'Try Again!';

        mainContent.innerHTML = `
          <section aria-label="Quiz Result" class="max-w-md mx-auto bg-yellow-200 rounded-xl p-6 shadow-lg text-yellow-900 text-center animate-fade-slide-in relative">
            <h2 class="text-4xl font-extrabold mb-4 select-none">${messageEmoji} ${messageText}</h2>
            <p class="text-2xl font-bold mb-6 select-none">You scored ${correctCount} out of ${currentQuiz.length} (${scorePercent}%)</p>
            <div class="flex flex-col space-y-4">
              <button id="btnRetrySame" class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-extrabold py-3 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300">
                Retry Same Quiz
              </button>
              <button id="btnRetryNew" class="bg-yellow-300 hover:bg-yellow-400 text-yellow-900 font-extrabold py-3 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300">
                Pick New Category
              </button>
            </div>
          </section>
        `;

        if (isGreat) {
          createConfetti();
        }

        document.getElementById('btnRetrySame').addEventListener('click', () => {
          startQuiz(currentCategoryId);
        });
        document.getElementById('btnRetryNew').addEventListener('click', () => {
          renderCategorySelection();
        });
      }

      // Render My Profile page
      function renderMyProfile() {
        clearInterval(timerInterval);
        if (!currentProfileId || !profiles[currentProfileId]) {
          renderProfilePrompt();
          return;
        }
        const profile = profiles[currentProfileId];
        const history = profile.quizHistory.slice().reverse();

        mainContent.innerHTML = `
          <section aria-label="My Profile" class="max-w-4xl mx-auto bg-yellow-200 rounded-xl p-6 shadow-lg animate-fade-slide-in">
            <h2 class="text-3xl font-extrabold mb-6 text-yellow-900 select-none">Hello, ${profile.name}!</h2>
            <h3 class="text-2xl font-bold mb-4 text-yellow-900 select-none">Quiz History</h3>
            <div id="scoreboard" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
              ${
                history.length === 0
                  ? `<p class="text-yellow-900 font-semibold select-none">No quiz history yet. Take some quizzes!</p>`
                  : history
                      .map(
                        (entry, i) => `
                <div
                  class="bg-yellow-300 rounded-lg p-4 shadow-md flex flex-col sm:flex-row sm:justify-between sm:items-center opacity-0 translate-x-10 fade-slide-in"
                  style="animation-delay: ${i * 0.1}s"
                  aria-label="Quiz on ${entry.categoryName} scored ${entry.score} out of ${entry.total} on ${formatDateTime(new Date(entry.date))}"
                >
                  <div class="text-yellow-900 font-bold text-lg select-none">${entry.categoryName}</div>
                  <div class="text-yellow-900 font-extrabold text-xl select-none">${entry.score} / ${entry.total}</div>
                  <div class="text-yellow-900 italic select-none">${formatDateTime(new Date(entry.date))}</div>
                  <div class="ml-2">
                    ${entry.score === entry.total ? '<i class="fas fa-trophy text-yellow-600 text-2xl" title="Perfect Score"></i>' : ''}
                    ${entry.score >= Math.floor(entry.total * 0.8) && entry.score < entry.total ? '<i class="fas fa-medal text-yellow-500 text-2xl" title="Great Score"></i>' : ''}
                  </div>
                </div>
              `
                      )
                      .join('')
              }
            </div>
            <div class="mt-6 flex justify-center space-x-4">
              <button id="btnBackToCategories" class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-extrabold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300">
                Back to Categories
              </button>
              <button id="btnSwitchProfile" class="bg-yellow-300 hover:bg-yellow-400 text-yellow-900 font-extrabold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300">
                Switch Profile
              </button>
            </div>
          </section>
        `;

        // Animate scoreboard entries fade-slide-in
        const scoreboardEntries = mainContent.querySelectorAll('#scoreboard > div');
        scoreboardEntries.forEach((el, i) => {
          el.style.animation = `fadeSlideIn 0.6s ease forwards`;
          el.style.animationDelay = `${i * 0.1}s`;
        });

        document.getElementById('btnBackToCategories').addEventListener('click', () => {
          renderCategorySelection();
        });
        document.getElementById('btnSwitchProfile').addEventListener('click', () => {
          renderProfilePrompt();
        });
      }

      // Button "My Profile" click handler
      btnMyProfile.addEventListener('click', () => {
        renderMyProfile();
      });

      // Initial load
      function init() {
        loadProfiles();
        if (!currentProfileId) {
          renderProfilePrompt();
        } else {
          renderCategorySelection();
        }
      }

      // Animate fade-slide-in class for initial load
      const styleSheet = document.createElement('style');
      styleSheet.textContent = `
        @keyframes fadeSlideIn {
          0% {
            opacity: 0;
            transform: translateX(20px);
          }
          100% {
            opacity: 1;
            transform: translateX(0);
          }
        }
        .animate-fade-slide-in {
          animation: fadeSlideIn 0.5s ease forwards;
        }
      `;
      document.head.appendChild(styleSheet);

      // Start app
      init();
    })();
  </script>
</body>
</html>